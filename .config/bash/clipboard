#!/bin/bash

# Macros to enable yanking, killing and putting
# to and from the system clipboard in vi-mode.
# Only supports yanking and killing the whole line.
paste_from_clipboard() {
    local shift=$1
    local head=${READLINE_LINE:0:READLINE_POINT+shift}
    local tail=${READLINE_LINE:READLINE_POINT+shift}
    # shellcheck disable=SC2155
    local paste=$(xclip -out -selection clipboard)
    local paste_len=${#paste}
    READLINE_LINE=${head}${paste}${tail}
    ((READLINE_POINT += paste_len + shift - 1))
}

yank_line_to_clipboard() {
    echo "$READLINE_LINE" | xclip -in -selection clipboard
}

kill_line_to_clipboard() {
    yank_line_to_clipboard
    READLINE_LINE=""
}

bind -m vi-command -x "\"P\": paste_from_clipboard 0"
bind -m vi-command -x "\"p\": paste_from_clipboard 1"
bind -m vi-command -x "\"yy\": yank_line_to_clipboard"
bind -m vi-command -x "\"dd\": kill_line_to_clipboard"
